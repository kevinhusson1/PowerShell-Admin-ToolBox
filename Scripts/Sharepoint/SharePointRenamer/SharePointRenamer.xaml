<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
    Title="SharePoint Renamer" Height="1000" Width="1500" WindowStartupLocation="CenterScreen" UseLayoutRounding="True"
    Background="{DynamicResource WhiteBrush}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/>    <!-- Content -->
            <RowDefinition Height="Auto"/> <!-- Logs/Status -->
        </Grid.RowDefinitions>

        <!-- =============================================================== -->
        <!-- 1. EN-TÃŠTE STANDARD (Replica Builder) -->
        <!-- =============================================================== -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" Padding="20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- IcÃ´ne -->
                <Border Grid.Column="0" Width="56" Height="56" CornerRadius="20" BorderBrush="{DynamicResource WhiteBrush}" BorderThickness="2" Background="{DynamicResource PrimaryLightBrush}">
                    <TextBlock Text="ðŸ·ï¸" FontSize="28" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                </Border>

                <!-- Textes -->
                <StackPanel Grid.Column="1" Margin="20,0,0,0" VerticalAlignment="Center">
                    <TextBlock Text="SharePoint Renamer" Foreground="{DynamicResource WhiteBrush}" FontSize="24" FontWeight="SemiBold"/>
                    <TextBlock Text="Analyse, RÃ©paration et Renommage de Projets" Foreground="{DynamicResource WhiteBrush}" Opacity="0.8" FontSize="14"/>
                </StackPanel>

                <!-- Auth -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">
                    <Button x:Name="ScriptAuthTextButton" Content="##loc:sp_builder.auth_not_connected##" Margin="0,0,10,0" VerticalAlignment="Center" Cursor="Arrow" FontSize="13" FontWeight="SemiBold">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Foreground" Value="{DynamicResource WhiteBrush}"/>
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}">
                                                <ContentPresenter VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                    <Button x:Name="ScriptAuthStatusButton" Style="{DynamicResource ProfileButtonStyle}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- =============================================================== -->
        <!-- 2. CONTENU PRINCIPAL -->
        <!-- =============================================================== -->
        <Grid Grid.Row="1" Background="{DynamicResource BackgroundLightBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Card 1: Target -->
                <RowDefinition Height="*"/>    <!-- Card 2 & 3: Analysis & Actions -->
            </Grid.RowDefinitions>

            <!-- ROW 0: TARGET URL CARD -->
            <Border Grid.Row="0" Margin="20,20,20,10" Style="{DynamicResource CardBorderStyle}" Padding="0">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <!-- Header Section -->
                    <StackPanel Grid.Row="0" Margin="15">
                        <Grid Margin="0,0,0,15">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <Border Grid.Column="0" Style="{DynamicResource StepIconBorderStyle}" Background="{DynamicResource InfoBackgroundBrush}">
                                <TextBlock Text="1" Foreground="{DynamicResource InfoBrush}" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>
                            <TextBlock Grid.Column="1" Text="Dossier Cible" Style="{DynamicResource StepHeaderTextStyle}"/>
                        </Grid>

                        <!-- Input Row -->
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="15"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <StackPanel Grid.Column="0">
                                <TextBlock Text="URL du dossier (SharePoint ou Teams)" Style="{DynamicResource H4Style}" Margin="0,0,0,5"/>
                                <TextBox x:Name="TargetUrlBox" Style="{DynamicResource StandardTextBoxStyle}" FontSize="14" Padding="5,8" VerticalContentAlignment="Center" ToolTip="Collez ici l'URL du dossier Ã  analyser"/>
                            </StackPanel>

                            <Button x:Name="BtnAnalyze" Grid.Column="2" Style="{DynamicResource PrimaryButtonStyle}" Width="140" Height="40" VerticalAlignment="Bottom" Content="ANALYSER â–º" FontWeight="Bold"/>
                        </Grid>
                    </StackPanel>
                    
                    <!-- Loading Bar -->
                    <StackPanel x:Name="LoadingPanel" Grid.Row="1" Visibility="Collapsed" Margin="0,0,0,0">
                        <ProgressBar IsIndeterminate="True" Height="4" BorderThickness="0" Background="Transparent" Foreground="{DynamicResource PrimaryBrush}"/>
                    </StackPanel>
                     <!-- Error Panel -->
                    <Border x:Name="ErrorPanel" Grid.Row="1" Visibility="Collapsed" Background="#FFEBEE" Padding="10" BorderBrush="#FFCDD2" BorderThickness="0,1,0,0">
                         <TextBlock x:Name="ErrorText" Text="Erreur..." Foreground="#C62828" TextWrapping="Wrap" HorizontalAlignment="Center"/>
                    </Border>
                </Grid>
            </Border>

            <!-- ROW 1: ANALYSIS & ACTIONS -->
            <Grid x:Name="DashboardPanel" Grid.Row="1" Margin="20,0,20,20" Visibility="Collapsed">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>   <!-- Analysis (Left) -->
                    <ColumnDefinition Width="20"/>  <!-- Spacer -->
                    <ColumnDefinition Width="300"/> <!-- Actions (Right) -->
                </Grid.ColumnDefinitions>

                <!-- LEFT: ANALYSIS CARD -->
                <Border Grid.Column="0" Style="{DynamicResource CardBorderStyle}" Padding="0">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/> <!-- Header Project -->
                            <RowDefinition Height="Auto"/> <!-- Divider -->
                            <RowDefinition Height="*"/>    <!-- Content Split -->
                        </Grid.RowDefinitions>
                        
                        <!-- Header Project Info -->
                        <Grid Grid.Row="0" Margin="20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Icon -->
                            <Border Grid.Column="0" Width="48" Height="48" CornerRadius="8" Background="{DynamicResource InfoBackgroundBrush}" Margin="0,0,15,0">
                                <TextBlock x:Name="ProjectIcon" Text="ðŸ—ï¸" FontSize="24" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                            </Border>

                            <!-- Titles -->
                            <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock x:Name="ProjectTitle" Text="Chargement..." FontSize="18" FontWeight="SemiBold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                <TextBlock x:Name="ProjectUrl" Text="https://..." FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" TextTrimming="CharacterEllipsis"/>
                            </StackPanel>

                            <!-- Status Badges -->
                            <StackPanel Grid.Column="2" HorizontalAlignment="Right" VerticalAlignment="Center">
                                <Border x:Name="BadgeStatus" Background="{DynamicResource BackgroundLightBrush}" CornerRadius="4" Padding="8,4" Margin="0,0,0,5">
                                    <TextBlock x:Name="TextStatus" Text="STATUS" FontWeight="Bold" FontSize="11" HorizontalAlignment="Center"/>
                                </Border>
                                <TextBlock x:Name="TextDate" Text="DÃ©ployÃ© le: ..." FontSize="10" Foreground="{DynamicResource TextDisabledBrush}" HorizontalAlignment="Right"/>
                                 <TextBlock x:Name="TextConfig" Text="Config: ..." FontSize="10" Foreground="{DynamicResource TextDisabledBrush}" HorizontalAlignment="Right"/>
                            </StackPanel>
                        </Grid>

                        <Rectangle Grid.Row="1" Height="1" Fill="{DynamicResource BorderLightBrush}" Margin="20,0"/>

                        <!-- Content Split -->
                        <Grid Grid.Row="2" Margin="20">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/> <!-- Structure -->
                                <ColumnDefinition Width="1"/> <!-- V-Line -->
                                <ColumnDefinition Width="*"/> <!-- Metadata -->
                            </Grid.ColumnDefinitions>
                            
                            <!-- STRUCTURE COLUMN -->
                            <Grid Grid.Column="0" Margin="0,0,20,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/> 
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="Analyse de la structure :" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    <TextBlock x:Name="KpiStructure" Text="Conformance" Margin="10,0,0,0" Foreground="{DynamicResource SuccessBrush}"/>
                                </StackPanel>
                                
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                    <StackPanel x:Name="StructureGrid">
                                        <!-- Items populated via PS -->
                                    </StackPanel>
                                </ScrollViewer>
                            </Grid>

                            <!-- Vertical Divider -->
                            <Rectangle Grid.Column="1" Fill="{DynamicResource BorderLightBrush}"/>

                            <!-- METADATA COLUMN -->
                             <Grid Grid.Column="2" Margin="20,0,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/> 
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>
                                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                                    <TextBlock Text="Analyse des mÃ©tadonnÃ©es :" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                    <TextBlock x:Name="KpiMeta" Text="Sync" Margin="10,0,0,0" Foreground="{DynamicResource SuccessBrush}"/>
                                </StackPanel>
                                
                                <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                                    <Grid x:Name="MetaGrid">
                                         <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <!-- Items populated via PS -->
                                    </Grid>
                                </ScrollViewer>
                            </Grid>

                        </Grid>
                    </Grid>
                </Border>

                <!-- RIGHT: ACTIONS CARD -->
                <Border Grid.Column="2" Style="{DynamicResource CardBorderStyle}" Padding="0">
                    <Grid Margin="15">
                        <!-- 1. MAIN ACTIONS PANEL -->
                        <StackPanel x:Name="ActionsPanel" Visibility="Visible">
                            <Grid Margin="0,0,0,15">
                                 <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Border Grid.Column="0" Style="{DynamicResource StepIconBorderStyle}" Background="{DynamicResource SecondaryBackgroundBrush}">
                                    <TextBlock Text="ðŸ› ï¸" Foreground="{DynamicResource SecondaryBrush}" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </Border>
                                <TextBlock Grid.Column="1" Text="Actions" Style="{DynamicResource StepHeaderTextStyle}"/>
                            </Grid>

                            <!-- Buttons -->
                            <Button x:Name="BtnRepair" Style="{DynamicResource SecondaryButtonStyle}" Background="#FF9800" Foreground="White" Height="40" Margin="0,0,0,10">
                                 <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ’ª" Margin="0,0,10,0"/>
                                    <TextBlock Text="RÃ©parer"/>
                                </StackPanel>
                            </Button>

                             <Button x:Name="BtnRename" Style="{DynamicResource SecondaryButtonStyle}" Background="#03A9F4" Foreground="White" Height="40" Margin="0,0,0,10">
                                 <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="âœï¸" Margin="0,0,10,0"/>
                                    <TextBlock Text="Renommer"/>
                                </StackPanel>
                            </Button>

                             <Separator Margin="0,10"/>

                             <Button x:Name="BtnForget" Style="{DynamicResource RedButtonStyle}" Height="40" Margin="0,0,0,0">
                                 <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="ðŸ—‘ï¸" Margin="0,0,10,0"/>
                                    <TextBlock Text="Oublier ce projet"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                        
                        <!-- 2. REPAIR CONFIG PANEL -->
                        <Grid x:Name="RepairConfigPanel" Visibility="Collapsed" Background="{DynamicResource WhiteBrush}">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>
                            
                            <!-- Header -->
                            <Grid Grid.Row="0" Margin="0,0,0,10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <TextBlock Text="SÃ©lection Correction" FontWeight="Bold" FontSize="14" VerticalAlignment="Center" Foreground="{DynamicResource TextPrimaryBrush}"/>
                                <Button x:Name="BtnCloseRepair" Grid.Column="1" Content="âŒ" Background="Transparent" BorderThickness="0" Foreground="Gray" Cursor="Hand" Margin="5,0,0,0"/>
                            </Grid>
                            
                            <!-- List of checks -->
                            <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Margin="0,0,0,10">
                                <StackPanel x:Name="RepairListPanel">
                                    <!-- Populated dynamically: CheckBox + TextBlock -->
                                </StackPanel>
                            </ScrollViewer>
                            
                            <!-- Actions -->
                            <Button x:Name="BtnConfirmRepair" Grid.Row="2" Content="Confirmer la RÃ©paration" Style="{DynamicResource PrimaryButtonStyle}" Background="#FF9800" Height="35"/>
                        </Grid>
                    </Grid>
                </Border>

            </Grid>
        </Grid>

         <!-- =============================================================== -->
        <!-- 3. LOGS / FOOTER -->
        <!-- =============================================================== -->
        <Border Grid.Row="2" Background="{DynamicResource WhiteBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0" Height="150">
            <Grid>
                 <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                
                <Border Grid.Row="0" Background="{DynamicResource BackgroundLightBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,0,0,1" Padding="15,5">
                     <TextBlock Text="Journal d'exÃ©cution" FontSize="11" FontWeight="Bold" Foreground="{DynamicResource TextSecondaryBrush}"/>
                </Border>

                <RichTextBox x:Name="LogRichTextBox" Grid.Row="1" Style="{DynamicResource StandardRichTextBoxStyle}" Margin="0" BorderThickness="0"/>
            </Grid>
        </Border>
                
        <!-- =============================================================== -->
        <!-- OVERLAY CONNEXION -->
        <!-- =============================================================== -->
        <Grid x:Name="AuthOverlay" Grid.RowSpan="3" Background="#F0FFFFFF" Visibility="Visible">
             <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                <TextBlock Text="ðŸ”’" FontSize="64" HorizontalAlignment="Center" Margin="0,0,0,20"/>
                <TextBlock Text="Connexion Requise" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" Foreground="{DynamicResource TextPrimaryBrush}"/>
                <TextBlock Text="Connectez-vous pour commencer l'analyse." HorizontalAlignment="Center" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,10,0,30"/>
                <Button x:Name="OverlayConnectButton" Content="Se Connecter Ã  Microsoft 365" Width="250" Height="50" Style="{DynamicResource PrimaryButtonStyle}"/>
             </StackPanel>
        </Grid>
    </Grid>
</Window>
