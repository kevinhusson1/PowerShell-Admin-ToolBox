<Window xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" Title="##loc:sp_builder.window_title##" TextOptions.TextFormattingMode="Display" Height="980" Width="1500" WindowStartupLocation="CenterScreen" UseLayoutRounding="True">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- 0: En-tÃªte + Menu -->
            <RowDefinition Height="*"/>
            <!-- 1: Contenu -->
        </Grid.RowDefinitions>

        <!-- =============================================================== -->
        <!-- 1. EN-TÃŠTE STANDARD + MENU INTÃ‰GRÃ‰ -->
        <!-- =============================================================== -->
        <Border Grid.Row="0" Background="{DynamicResource PrimaryBrush}" Padding="20">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- IcÃ´ne -->
                <Border Grid.Column="0" Width="56" Height="56" CornerRadius="20" BorderBrush="{DynamicResource WhiteBrush}" BorderThickness="2" Background="{DynamicResource PrimaryLightBrush}">
                    <Rectangle Fill="{DynamicResource WhiteBrush}" Margin="14">
                        <Rectangle.OpacityMask>
                            <ImageBrush x:Name="HeaderIconBrush" Stretch="Uniform"/>
                        </Rectangle.OpacityMask>
                    </Rectangle>
                </Border>

                <!-- Textes -->
                <StackPanel Grid.Column="1" Margin="20,0,0,0" VerticalAlignment="Center">
                    <TextBlock x:Name="HeaderTitleText" Text="##loc:scripts.sharepoint_builder.name##" Foreground="{DynamicResource WhiteBrush}" FontSize="24" FontWeight="SemiBold"/>
                    <TextBlock x:Name="HeaderSubtitleText" Text="##loc:scripts.sharepoint_builder.description##" Foreground="{DynamicResource WhiteBrush}" Opacity="0.8" FontSize="14"/>
                </StackPanel>

                <!-- Auth -->
                <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center">

                    <!-- Nom / Ã‰tat (Texte) -->
                    <Button x:Name="ScriptAuthTextButton" Content="##loc:sp_builder.auth_not_connected##" Margin="0,0,10,0" VerticalAlignment="Center" Cursor="Arrow" FontSize="13" FontWeight="SemiBold">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="BorderThickness" Value="0"/>
                                <Setter Property="Foreground" Value="{DynamicResource WhiteBrush}"/>
                                <!-- Blanc sur fond bleu -->
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border Background="{TemplateBinding Background}">
                                                <ContentPresenter VerticalAlignment="Center"/>
                                            </Border>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- Macaron (Cercle) -->
                    <Button x:Name="ScriptAuthStatusButton" Style="{DynamicResource ProfileButtonStyle}" VerticalAlignment="Center"/>
                </StackPanel>
            </Grid>
        </Border>
        <!-- Ligne 2 : Menu TabControl -->
        <Grid Grid.Row="1" Background="{DynamicResource PrimaryBrush}">
            <TabControl x:Name="MainTabControl" Style="{DynamicResource NavTabControlStyle}">
                <!-- ONGLET DÃ‰PLOIEMENT -->
                <TabItem Header="##loc:sp_builder.tab_deploy##" IsSelected="True">
                    <Grid Background="{DynamicResource WhiteBrush}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="150"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- LIGNE 1 : CIBLE ET MODÃˆLE -->
                        <Grid Grid.Row="0" Margin="15,15,15,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- COLONNE 1 : CIBLE ET EXPLORATEUR -->
                            <Border Grid.Column="0" Style="{DynamicResource CardBorderStyle}" Padding="0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <!-- Header Selecteurs -->
                                        <RowDefinition Height="*"/>
                                        <!-- TreeView -->
                                    </Grid.RowDefinitions>

                                    <!-- 1.1 Header Selecteurs (Site / Lib) -->
                                    <StackPanel Grid.Row="0" Margin="15">
                                        <Grid Margin="0,0,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Style="{DynamicResource StepIconBorderStyle}" Background="{DynamicResource InfoBackgroundBrush}">
                                                <TextBlock Text="##loc:sp_builder.step_1_id##" Foreground="{DynamicResource InfoBrush}" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Text="##loc:sp_builder.step_1_title##" Style="{DynamicResource StepHeaderTextStyle}" Grid.Column="1"/>
                                        </Grid>
                                        <Grid>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="10"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <StackPanel Grid.Column="0">
                                                <TextBlock Text="##loc:sp_builder.label_site##" Style="{DynamicResource H4Style}"/>
                                                <ComboBox x:Name="SiteComboBox" Style="{DynamicResource StandardEditableComboBoxStyle}" Margin="0,5,0,10"/>
                                            </StackPanel>
                                            <StackPanel Grid.Column="2">
                                                <TextBlock Text="##loc:sp_builder.label_library##" Style="{DynamicResource H4Style}"/>
                                                <ComboBox x:Name="LibraryComboBox" Style="{DynamicResource StandardComboBoxStyle}" Margin="0,5,0,0"/>
                                            </StackPanel>
                                        </Grid>
                                    </StackPanel>

                                    <!-- 1.2 Target Explorer (TreeView) -->
                                    <Border Grid.Row="1" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0">
                                        <Grid>
                                            <TreeView x:Name="TargetExplorerTreeView" Style="{DynamicResource ModernTreeViewStyle}" BorderThickness="0" Padding="5">
                                                <!-- Sera rempli dynamiquement -->
                                                <TreeViewItem Header="##loc:sp_builder.msg_select_library##" Foreground="{DynamicResource TextDisabledBrush}" FontStyle="Italic" IsEnabled="False"/>
                                            </TreeView>

                                            <Grid x:Name="ExplorerLoadingOverlay" Background="#80FFFFFF" Visibility="Collapsed" IsHitTestVisible="True">
                                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                                    <TextBlock Text="â³" FontSize="24" HorizontalAlignment="Center"/>
                                                    <TextBlock Text="##loc:sp_builder.msg_loading##" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                                </StackPanel>
                                            </Grid>
                                        </Grid>
                                    </Border>
                                </Grid>
                            </Border>

                            <!-- COLONNE 2 : MODÃˆLE ET PREVIEW -->
                            <Border Grid.Column="2" Style="{DynamicResource CardBorderStyle}" Padding="0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <!-- Header Selecteurs -->
                                        <RowDefinition Height="*"/>
                                        <!-- TreeView -->
                                    </Grid.RowDefinitions>

                                    <StackPanel Grid.Row="0" Margin="15">
                                        <Grid Margin="0,0,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Style="{DynamicResource StepIconBorderStyle}" Background="{DynamicResource SecondaryBackgroundBrush}">
                                                <TextBlock Text="##loc:sp_builder.step_2_id##" Foreground="{DynamicResource InfoBrush}" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Grid.Column="1" Text="##loc:sp_builder.step_2_title##" Style="{DynamicResource StepHeaderTextStyle}"/>

                                            <TextBlock Grid.Column="2" x:Name="TemplateDescText" Text="â„¹ï¸" ToolTip="Voir description" VerticalAlignment="Center" Cursor="Help"/>
                                        </Grid>

                                        <ComboBox x:Name="TemplateComboBox" Style="{DynamicResource StandardComboBoxStyle}" Height="32"/>
                                    </StackPanel>
                                    <Border Grid.Row="1" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0" Padding="0,0,0,6">
                                        <TreeView x:Name="PreviewTreeView" Style="{DynamicResource ModernTreeViewStyle}" BorderThickness="0" Padding="5"/>
                                    </Border>
                                </Grid>

                            </Border>
                        </Grid>

                        <!-- LIGNE 2 : DESTINATION ET OPTIONS -->
                        <Grid Grid.Row="1" Margin="15,0,15,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="20"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- COLONNE 1 : DESTINATION -->
                            <Border Grid.Column="0" Style="{DynamicResource CardBorderStyle}" Padding="0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <StackPanel Grid.Row="0" Margin="15">
                                        <Grid Margin="0,0,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Style="{DynamicResource StepIconBorderStyle}" Background="{DynamicResource WarningBackgroundBrush}">
                                                <TextBlock Text="##loc:sp_builder.step_3_id##" Foreground="{DynamicResource WarningBrush}" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                            </Border>
                                            <TextBlock Grid.Column="1" Text="##loc:sp_builder.step_3_title##" Style="{DynamicResource StepHeaderTextStyle}"/>
                                            <Border Grid.Column="2" Background="{DynamicResource BackgroundMediumBrush}" CornerRadius="4" Padding="6,2" VerticalAlignment="Center">
                                                <TextBlock Text="##loc:sp_builder.label_optional##" FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            </Border>
                                        </Grid>

                                        <!-- Toggle + Choix -->
                                        <Grid Grid.Row="1" Margin="0,0,15,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <CheckBox Grid.Column="0" x:Name="CreateFolderCheckBox" Style="{DynamicResource ToggleSwitchStyle}" VerticalAlignment="Center"/>
                                            <TextBlock Grid.Column="1" Text="##loc:sp_builder.label_create_root_folder##" VerticalAlignment="Center" Margin="10,0,0,0" FontWeight="SemiBold"/>
                                            <ComboBox Grid.Column="2" x:Name="FolderTemplateComboBox" Style="{DynamicResource StandardComboBoxStyle}" IsEnabled="{Binding IsChecked, ElementName=CreateFolderCheckBox}" ToolTip="RÃ¨gle de nommage du dossier racine"/>
                                        </Grid>


                                        <!-- Formulaire Dynamique (Scrollable) -->
                                        <ScrollViewer Grid.Row="2" HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Margin="0,0,0,15" Padding="0,0,0,5">
                                            <StackPanel x:Name="DynamicFormPanel" Orientation="Horizontal" HorizontalAlignment="Left"/>
                                        </ScrollViewer>

                                        <!-- RÃ©sultat Nom -->
                                        <Grid Grid.Row="3">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock Text="##loc:sp_builder.label_name##" VerticalAlignment="Center" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,0,10,0"/>
                                            <Border Grid.Column="1" Background="{DynamicResource BackgroundMediumBrush}" CornerRadius="4" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="1">
                                                <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Disabled" Padding="8,4" BorderThickness="0">
                                                    <TextBlock x:Name="FolderNamePreviewText" Text="..." FontFamily="Consolas" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}" FontSize="12" VerticalAlignment="Center"/>
                                                </ScrollViewer>
                                            </Border>
                                        </Grid>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- COLONNE 2 : OPTIONS DÃ‰PLOIEMENT -->
                            <Border Grid.Column="2" Style="{DynamicResource CardBorderStyle}" Padding="0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>
                                    <StackPanel Grid.Row="0" Margin="15">
                                        <Grid Margin="0,0,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Border Grid.Column="0" Style="{DynamicResource StepIconBorderStyle}" Background="{DynamicResource SecondaryBackgroundBrush}">
                                                <TextBlock Text="âš™" Foreground="{DynamicResource SecondaryBrush}" FontWeight="Bold" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16"/>
                                            </Border>
                                            <TextBlock Grid.Column="1" Text="##loc:sp_builder.label_deployment##" Style="{DynamicResource StepHeaderTextStyle}"/>
                                        </Grid>
                                        <Grid Grid.Row="1">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <CheckBox x:Name="OverwritePermissionsCheckBox" Grid.Column="0" Margin="0,0,15,0" Style="{DynamicResource ToggleSwitchStyle}"/>
                                            <TextBlock Grid.Column="1" Text="##loc:sp_builder.label_overwrite_permissions##" VerticalAlignment="Center" FontWeight="SemiBold"/>
                                        </Grid>
                                        <Grid Grid.Row="2" Margin="0,15,0,15">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <ComboBox Grid.Column="0" x:Name="DeployConfigComboBox" Style="{DynamicResource StandardComboBoxStyle}" Height="32" Margin="0,0,5,0" ToolTip="Configurations sauvegardÃ©es"/>
                                            <StackPanel Grid.Column="1" Orientation="Horizontal">
                                                <Button x:Name="LoadConfigButton" Style="{DynamicResource PrimaryButtonStyle}" Width="32" Height="32" Margin="0,0,5,0" ToolTip="Charger" Padding="0">
                                                    <TextBlock Text="&#xE8E5;" FontFamily="Segoe MDL2 Assets" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Button>
                                                <Button x:Name="SaveConfigButton" Style="{DynamicResource GreenButtonStyle}" Width="32" Height="32" Margin="0,0,5,0" ToolTip="Sauvegarder" Padding="0">
                                                    <TextBlock Text="&#xE74E;" FontFamily="Segoe MDL2 Assets" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Button>
                                                <Button x:Name="DeleteConfigButton" Style="{DynamicResource RedButtonStyle}" Width="32" Height="32" ToolTip="Supprimer" Padding="0">
                                                    <TextBlock Text="&#xE74D;" FontFamily="Segoe MDL2 Assets" FontSize="14" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                                </Button>
                                            </StackPanel>
                                        </Grid>

                                    </StackPanel>
                                </Grid>
                            </Border>
                        </Grid>
                        <!-- SPLITTER -->
                        <GridSplitter Grid.Row="2" Height="5" HorizontalAlignment="Stretch" VerticalAlignment="Center" Background="Transparent" ResizeBehavior="PreviousAndNext"/>

                        <!-- ZONE LOGS (Row 3) -->
                        <Border Grid.Row="3" Background="{DynamicResource BackgroundLightBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0" Padding="0" ClipToBounds="True">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Progress (Logs) -->
                                <ProgressBar Grid.Row="0" x:Name="LogsProgressBar" Height="4" BorderThickness="0" Background="Transparent" Foreground="{DynamicResource PrimaryBrush}" VerticalAlignment="Bottom"/>

                                <!-- Header Logs -->
                                <Border Grid.Row="1" Background="{DynamicResource BackgroundLightBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,0,0,1" Padding="15,8">
                                    <Grid>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="##loc:sp_builder.label_logs##" FontWeight="SemiBold" VerticalAlignment="Center" Margin="5,0,20,0"/>
                                            <TextBlock x:Name="LogsStatusText" Text="##loc:sp_builder.msg_waiting##" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center"/>
                                        </StackPanel>


                                    </Grid>
                                </Border>

                                <RichTextBox Grid.Row="2" x:Name="LogRichTextBox" Style="{DynamicResource StandardRichTextBoxStyle}" BorderThickness="0" Background="{DynamicResource WhiteBrush}" FontFamily="Consolas" Foreground="{DynamicResource TextPrimaryBrush}"/>
                            </Grid>
                        </Border>

                        <!-- ACTION BAR / STATUS BAR (Row 4 - Tout en bas) -->
                        <Border Grid.Row="4" Background="{DynamicResource BackgroundLightBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0" Padding="15,10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Status Text Left -->
                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock x:Name="ProgressStatusText" Text="##loc:sp_builder.msg_ready##" FontWeight="SemiBold" VerticalAlignment="Center"/>
                                    <ProgressBar x:Name="MainProgressBar" Width="150" Height="10" Margin="15,0,0,0" Visibility="Hidden" VerticalAlignment="Center"/>
                                </StackPanel>

                                <!-- Action Buttons Right -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                    <Button x:Name="ResetUIButton" Content="##loc:sp_builder.btn_reset##" Style="{DynamicResource RedButtonStyle}" Height="32" Margin="0,0,15,0"/>
                                    <Button x:Name="CopyUrlButton" Content="##loc:sp_builder.btn_copy_url##" Style="{DynamicResource SecondaryButtonStyle}" Height="32" Margin="0,0,5,0" IsEnabled="False"/>
                                    <Button x:Name="OpenUrlButton" Content="##loc:sp_builder.btn_open##" Style="{DynamicResource SecondaryButtonStyle}" Height="32" Margin="0,0,15,0" IsEnabled="False"/>
                                    <Button x:Name="DeployButton" Content="##loc:sp_builder.btn_deploy##" Style="{DynamicResource GreenButtonStyle}" Width="200" Height="36" FontWeight="Bold"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- PLACEHOLDERS -->
                <!-- ONGLET 2 : Ã‰DITEUR DE MODÃˆLE -->
                <TabItem Header="##loc:sp_builder.tab_editor_template##">
                    <Grid Background="{DynamicResource BackgroundLightBrush}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Toolbar -->
                            <RowDefinition Height="*"/>
                            <!-- Workspace -->
                            <RowDefinition Height="Auto"/>
                            <!-- Footer -->
                        </Grid.RowDefinitions>

                        <!-- 1. BARRE D'OUTILS & CONTEXTE -->
                        <Border Grid.Row="0" Background="{DynamicResource WhiteBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,0,0,1" Padding="20,15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <!-- Gestion Fichier -->
                                    <ColumnDefinition Width="*"/>
                                    <!-- Espace -->
                                </Grid.ColumnDefinitions>

                                <!-- Gestion BDD -->
                                <StackPanel Grid.Column="0" Orientation="Horizontal">
                                    <StackPanel VerticalAlignment="Center" Margin="0,0,10,0">
                                        <TextBlock Text="##loc:sp_builder.label_existing_template##" FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                        <ComboBox x:Name="EditorLoadComboBox" Width="200" Style="{DynamicResource StandardComboBoxStyle}" Height="32" ToolTip="SÃ©lectionner un modÃ¨le existant"/>
                                    </StackPanel>
                                    <Button x:Name="EditorLoadButton" Content="##loc:sp_builder.btn_load##" Style="{DynamicResource SecondaryButtonStyle}" Height="32" VerticalAlignment="Bottom" ToolTip="Charger ce modÃ¨le dans l'Ã©diteur"/>
                                    <Button x:Name="EditorDeleteTemplateButton" Content="ðŸ—‘ï¸" Style="{DynamicResource SecondaryButtonStyle}" Height="32" Width="40" Padding="0" VerticalAlignment="Bottom" Margin="5,0,0,0" Foreground="{DynamicResource DangerBrush}" ToolTip="Supprimer le modÃ¨le sÃ©lectionnÃ©"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- 2. ZONE DE TRAVAIL -->
                        <Grid Grid.Row="1" Margin="25">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1*"/>
                                <!-- Arbre -->
                                <ColumnDefinition Width="25"/>
                                <!-- Espace -->
                                <ColumnDefinition Width="1.5*"/>
                                <!-- PropriÃ©tÃ©s -->
                            </Grid.ColumnDefinitions>

                            <!-- COLONNE GAUCHE : STRUCTURE -->
                            <Border Grid.Column="0" Style="{DynamicResource CardBorderStyle}" Padding="0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Header Arbre -->
                                    <Border Grid.Row="0" Background="{DynamicResource BackgroundLightBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,0,0,1" Padding="15,10" CornerRadius="10,10,0,0">
                                        <Grid>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="ðŸ“‚" Margin="0,0,10,0"/>
                                                <TextBlock Text="##loc:sp_builder.label_template_structure##" FontWeight="SemiBold"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- TreeView Ã‰ditable -->
                                    <TreeView x:Name="EditorTreeView" Grid.Row="1" Style="{DynamicResource ModernTreeViewStyle}" BorderThickness="0" Margin="5"/>

                                    <!-- Toolbar Arbre -->
                                    <Border Grid.Row="2" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0" Padding="10" CornerRadius="0,0,15,15">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button x:Name="EditorAddRootButton" Content="##loc:sp_builder.btn_add_root##" Style="{DynamicResource SecondaryButtonStyle}" Height="30" FontSize="11" Margin="0,0,5,0" ToolTip="Ajouter un dossier Ã  la racine"/>
                                            <Button x:Name="EditorAddChildButton" Content="##loc:sp_builder.btn_add_child##" Style="{DynamicResource SecondaryButtonStyle}" Height="30" FontSize="11" Margin="0,0,5,0" ToolTip="Ajouter un sous-dossier"/>
                                            <Button x:Name="EditorDeleteNodeButton" Content="ðŸ—‘ï¸" Style="{DynamicResource SecondaryButtonStyle}" Height="30" Width="40" Padding="0" Foreground="{DynamicResource DangerBrush}" ToolTip="Supprimer l'Ã©lÃ©ment sÃ©lectionnÃ©"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>

                            <!-- COLONNE DROITE : INSPECTEUR -->
                            <Border Grid.Column="2" Style="{DynamicResource CardBorderStyle}" Padding="0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <Border Grid.Row="0" Background="{DynamicResource BackgroundLightBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,0,0,1" Padding="15,10" CornerRadius="10,10,0,0">
                                        <Grid>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="ðŸ› ï¸" Margin="0,0,10,0"/>
                                                <TextBlock Text="##loc:sp_builder.label_folder_properties##" FontWeight="SemiBold"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>

                                    <!-- Formulaire PropriÃ©tÃ©s -->
                                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20">
                                        <Grid>

                                            <!-- A. MODE DOSSIER -->
                                            <StackPanel x:Name="EdPanelFolder">

                                                <!-- 1. Identification -->
                                                <TextBlock Text="##loc:sp_builder.label_folder_name##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="EditorFolderNameTextBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,20" ToolTip="Nom du dossier dans SharePoint"/>

                                                <!-- 2. Permissions -->
                                                <Grid Margin="0,0,0,10">
                                                    <TextBlock Text="##loc:sp_builder.label_permissions##" Style="{DynamicResource H4Style}" VerticalAlignment="Center"/>
                                                    <Button x:Name="EditorAddPermButton" Content="+" Style="{DynamicResource PrimaryButtonStyle}" Width="24" Height="24" Padding="0" HorizontalAlignment="Right" ToolTip="Ajouter une permission"/>
                                                </Grid>

                                                <!-- Liste Permissions -->
                                                <ListBox x:Name="EditorPermissionsListBox" Margin="0,0,0,20" BorderThickness="0" Background="Transparent">
                                                    <ListBox.ItemContainerStyle>
                                                        <Style TargetType="ListBoxItem">
                                                            <Setter Property="Padding" Value="0"/>
                                                            <Setter Property="Margin" Value="0,0,0,5"/>
                                                            <Setter Property="Background" Value="Transparent"/>
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="ListBoxItem">
                                                                        <ContentPresenter/>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </ListBox.ItemContainerStyle>
                                                </ListBox>

                                                <Separator Background="{DynamicResource BorderLightBrush}" Margin="0,0,0,20"/>

                                                <!-- 3. MÃ©tadonnÃ©es -->
                                                <Grid Margin="0,0,0,10">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="##loc:sp_builder.label_metadata_tags##" Style="{DynamicResource H4Style}" VerticalAlignment="Center"/>
                                                        <Border x:Name="EditorMetadataBadge" Background="{DynamicResource InfoBackgroundBrush}" CornerRadius="4" Padding="6,2" Margin="10,0,0,0" Visibility="Collapsed">
                                                            <TextBlock Text="##loc:sp_builder.badge_schema_linked##" FontSize="9" Foreground="{DynamicResource InfoBrush}" FontWeight="Bold"/>
                                                        </Border>
                                                    </StackPanel>
                                                    <Button x:Name="EditorAddTagButton" Content="+" Style="{DynamicResource PrimaryButtonStyle}" Width="24" Height="24" Padding="0" HorizontalAlignment="Right" ToolTip="Ajouter un tag"/>
                                                </Grid>

                                                <!-- Liste Tags -->
                                                <ListBox x:Name="EditorTagsListBox" Margin="0,0,0,20" BorderThickness="0" Background="Transparent">
                                                    <ListBox.ItemContainerStyle>
                                                        <Style TargetType="ListBoxItem">
                                                            <Setter Property="Padding" Value="0"/>
                                                            <Setter Property="Margin" Value="0,0,0,5"/>
                                                            <Setter Property="Background" Value="Transparent"/>
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="ListBoxItem">
                                                                        <ContentPresenter/>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </ListBox.ItemContainerStyle>
                                                </ListBox>

                                                <!-- 4. Liens  -->
                                                <Separator Background="{DynamicResource BorderLightBrush}" Margin="0,0,0,20"/>
                                                <Grid Margin="0,0,0,10">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="##loc:sp_builder.label_links_shortcuts##" Style="{DynamicResource H4Style}" VerticalAlignment="Center"/>
                                                    </StackPanel>
                                                    <Button x:Name="EditorAddLinkButton" Content="+" Style="{DynamicResource PrimaryButtonStyle}" Width="24" Height="24" Padding="0" HorizontalAlignment="Right" ToolTip="Ajouter un lien"/>
                                                </Grid>

                                                <!-- Liste Liens -->
                                                <ListBox x:Name="EditorLinksListBox" Margin="0,0,0,20" BorderThickness="0" Background="Transparent">
                                                    <ListBox.ItemContainerStyle>
                                                        <Style TargetType="ListBoxItem">
                                                            <Setter Property="Padding" Value="0"/>
                                                            <Setter Property="Margin" Value="0,0,0,5"/>
                                                            <Setter Property="Background" Value="Transparent"/>
                                                            <Setter Property="Template">
                                                                <Setter.Value>
                                                                    <ControlTemplate TargetType="ListBoxItem">
                                                                        <ContentPresenter/>
                                                                    </ControlTemplate>
                                                                </Setter.Value>
                                                            </Setter>
                                                        </Style>
                                                    </ListBox.ItemContainerStyle>
                                                </ListBox>

                                            </StackPanel>

                                            <!-- B. MODE PERMISSION -->
                                            <StackPanel x:Name="EdPanelPerm" Visibility="Collapsed">
                                                <Border Background="{DynamicResource InfoBackgroundBrush}" CornerRadius="4" Padding="10" Margin="0,0,0,20">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="ðŸ‘¤" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="##loc:sp_builder.title_edit_permission##" FontWeight="SemiBold" Foreground="{DynamicResource InfoBrush}"/>
                                                    </StackPanel>
                                                </Border>

                                                <TextBlock Text="##loc:sp_builder.label_user_group_email##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="EdPermIdentityBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,20" ToolTip="Email de l'utilisateur ou nom du groupe SP"/>

                                                <TextBlock Text="##loc:sp_builder.label_access_level##" Style="{DynamicResource H4Style}"/>
                                                <ComboBox x:Name="EdPermLevelBox" Style="{DynamicResource StandardComboBoxStyle}" Margin="0,5,0,20" ToolTip="Niveau d'autorisation (Read, Contribute, Full Control)"/>

                                                <Button x:Name="EdPermDeleteButton" Content="##loc:sp_builder.btn_delete_permission##" Style="{DynamicResource StandardButtonStyle}" Foreground="{DynamicResource DangerBrush}" BorderBrush="{DynamicResource DangerBrush}" Background="Transparent" Margin="0,20,0,0"/>
                                            </StackPanel>

                                            <!-- C. MODE TAG -->
                                            <StackPanel x:Name="EdPanelTag" Visibility="Collapsed">
                                                <Border Background="{DynamicResource InfoBackgroundBrush}" CornerRadius="4" Padding="10" Margin="0,0,0,20">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="ðŸ·ï¸" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="##loc:sp_builder.title_edit_tag##" FontWeight="SemiBold" Foreground="{DynamicResource InfoBrush}"/>
                                                    </StackPanel>
                                                </Border>

                                                <TextBlock Text="##loc:sp_builder.label_column_name##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="EdTagNameBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,20" ToolTip="Nom interne de la colonne SharePoint"/>

                                                <TextBlock Text="##loc:sp_builder.label_value_term##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="EdTagValueBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,20" ToolTip="Valeur par dÃ©faut ou Terme de taxonomie"/>

                                                <Button x:Name="EdTagDeleteButton" Content="##loc:sp_builder.btn_delete_tag##" Style="{DynamicResource StandardButtonStyle}" Foreground="{DynamicResource DangerBrush}" BorderBrush="{DynamicResource DangerBrush}" Background="Transparent" Margin="0,20,0,0"/>
                                            </StackPanel>

                                            <!-- D. MODE LINK -->
                                            <StackPanel x:Name="EdPanelLink" Visibility="Collapsed">
                                                <Border Background="{DynamicResource InfoBackgroundBrush}" CornerRadius="4" Padding="10" Margin="0,0,0,20">
                                                    <StackPanel Orientation="Horizontal">
                                                        <TextBlock Text="ðŸ”—" Margin="0,0,10,0" VerticalAlignment="Center"/>
                                                        <TextBlock Text="##loc:sp_builder.title_edit_link##" FontWeight="SemiBold" Foreground="{DynamicResource InfoBrush}"/>
                                                    </StackPanel>
                                                </Border>

                                                <TextBlock Text="##loc:sp_builder.label_display_name##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="EdLinkNameBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,20" ToolTip="Texte affichÃ© pour le lien"/>

                                                <TextBlock Text="##loc:sp_builder.label_target_url##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="EdLinkUrlBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,20" ToolTip="Adresse URL de destination"/>

                                                <Button x:Name="EdLinkDeleteButton" Content="##loc:sp_builder.btn_delete_link##" Style="{DynamicResource StandardButtonStyle}" Foreground="{DynamicResource DangerBrush}" BorderBrush="{DynamicResource DangerBrush}" Background="Transparent" Margin="0,20,0,0"/>
                                            </StackPanel>

                                        </Grid>
                                    </ScrollViewer>

                                    <!-- Overlay "Aucune sÃ©lection" -->
                                    <Grid Grid.Row="1" x:Name="EdPanelNoSel" Background="{DynamicResource WhiteBrush}" Visibility="Visible">
                                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0.5">
                                            <TextBlock Text="ðŸ‘†" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                            <TextBlock Text="##loc:sp_builder.msg_select_folder_tree##" FontSize="14"/>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                            </Border>
                        </Grid>
                        <!-- Footer Editeur -->
                        <Border Grid.Row="2" Background="{DynamicResource WhiteBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0" Padding="25,15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Status Text -->
                                <TextBlock Grid.Column="0" x:Name="EditorStatusText" Text="##loc:sp_builder.msg_ready##" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,20,0"/>

                                <!-- Actions Globales -->
                                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                                    <!-- Contexte de Validation -->
                                    <Border Background="{DynamicResource InfoBackgroundBrush}" CornerRadius="8" Padding="10,5" BorderBrush="{DynamicResource InfoBrush}" BorderThickness="1" Margin="0,0,10,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="ðŸŽ¯" VerticalAlignment="Center" Margin="0,0,8,0"/>
                                            <StackPanel VerticalAlignment="Center">
                                                <TextBlock Text="##loc:sp_builder.label_validation_context##" FontSize="9" Foreground="{DynamicResource InfoHoverBrush}" FontWeight="Bold"/>
                                                <TextBlock x:Name="EditorContextStatusText" Text="##loc:sp_builder.msg_no_target_site##" FontSize="11" FontWeight="SemiBold" Foreground="{DynamicResource InfoHoverBrush}"/>
                                            </StackPanel>
                                            <Button x:Name="EditorDefineTargetButton" Content="##loc:sp_builder.btn_define##" Style="{DynamicResource SecondaryButtonStyle}" Height="24" FontSize="10" Padding="8,0" Margin="10,0,0,0" Background="{DynamicResource WhiteBrush}" ToolTip="Choisir un site SharePoint pour valider les colonnes"/>
                                        </StackPanel>
                                    </Border>

                                    <Button x:Name="EditorNewButton" Content="##loc:sp_builder.btn_new##" Style="{DynamicResource SecondaryButtonStyle}" Height="36" Margin="0,0,10,0" ToolTip="CrÃ©er un nouveau modÃ¨le vierge"/>
                                    <Button x:Name="EditorSaveButton" Content="##loc:sp_builder.btn_save##" Style="{DynamicResource PrimaryButtonStyle}" Height="36" ToolTip="Enregistrer les modifications dans la base de donnÃ©es"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- ONGLET 3 : FORMULAIRE DESTINATION -->
                <TabItem Header="##loc:sp_builder.tab_form_destination##">
                    <Grid Background="{DynamicResource BackgroundLightBrush}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <!-- Toolbar -->
                            <RowDefinition Height="*"/>
                            <!-- Workspace -->
                            <RowDefinition Height="Auto"/>
                            <!-- Preview -->
                            <RowDefinition Height="Auto"/>
                            <!-- Footer -->
                        </Grid.RowDefinitions>

                        <!-- 1. BARRE D'OUTILS -->
                        <Border Grid.Row="0" Background="{DynamicResource WhiteBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,0,0,1" Padding="20,15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <!-- Gestion Fichier -->
                                    <ColumnDefinition Width="*"/>
                                    <!-- Espace -->
                                </Grid.ColumnDefinitions>

                                <!-- Gestion BDD -->
                                <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Bottom">
                                    <StackPanel VerticalAlignment="Bottom" Margin="0,0,10,0">
                                        <TextBlock Text="##loc:sp_builder.label_existing_rule##" FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                        <ComboBox x:Name="FormLoadComboBox" Width="200" Style="{DynamicResource StandardComboBoxStyle}" Height="32"/>
                                    </StackPanel>
                                    <Button x:Name="FormLoadButton" Content="##loc:sp_builder.btn_load##" Style="{DynamicResource SecondaryButtonStyle}" Height="32" VerticalAlignment="Bottom" ToolTip="##loc:form_editor.load_tooltip##"/>
                                    <Button x:Name="FormDeleteButton" Content="ðŸ—‘ï¸" Style="{DynamicResource SecondaryButtonStyle}" Height="32" Width="40" Padding="0" VerticalAlignment="Bottom" Margin="5,0,0,0" Foreground="{DynamicResource DangerBrush}" ToolTip="##loc:form_editor.delete_tooltip##"/>
                                </StackPanel>
                            </Grid>
                        </Border>

                        <!-- 2. ZONE DE TRAVAIL -->
                        <Grid Grid.Row="1" Margin="25">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="1*"/>
                                <!-- Liste Champs -->
                                <ColumnDefinition Width="25"/>
                                <!-- Espace -->
                                <ColumnDefinition Width="1*"/>
                                <!-- PropriÃ©tÃ©s -->
                            </Grid.ColumnDefinitions>

                            <!-- GAUCHE : LISTE DES CHAMPS -->
                            <Border Grid.Column="0" Style="{DynamicResource CardBorderStyle}" Padding="0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <!-- Header -->
                                    <Border Grid.Row="0" Background="{DynamicResource BackgroundLightBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,0,0,1" Padding="15,10" CornerRadius="10,10,0,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="abc" FontFamily="Consolas" Margin="0,0,10,0" FontWeight="Bold" Foreground="{DynamicResource TextSecondaryBrush}"/>
                                            <TextBlock Text="##loc:sp_builder.label_naming_structure##" FontWeight="SemiBold"/>
                                        </StackPanel>
                                    </Border>

                                    <!-- Liste Champs -->
                                    <ListBox x:Name="FormFieldsListBox" Grid.Row="1" BorderThickness="0" Background="{DynamicResource WhiteBrush}" Padding="10">
                                        <ListBox.ItemContainerStyle>
                                            <Style TargetType="ListBoxItem">
                                                <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                                <Setter Property="Padding" Value="10"/>
                                                <Setter Property="Margin" Value="0,0,0,5"/>
                                                <Setter Property="Background" Value="{DynamicResource BackgroundLightBrush}"/>
                                                <Setter Property="BorderThickness" Value="1"/>
                                                <Setter Property="BorderBrush" Value="{DynamicResource BorderLightBrush}"/>
                                                <Setter Property="Template">
                                                    <Setter.Value>
                                                        <ControlTemplate TargetType="ListBoxItem">
                                                            <Border Background="{TemplateBinding Background}" BorderBrush="{TemplateBinding BorderBrush}" BorderThickness="{TemplateBinding BorderThickness}" CornerRadius="6" Padding="{TemplateBinding Padding}">
                                                                <ContentPresenter/>
                                                            </Border>
                                                            <ControlTemplate.Triggers>
                                                                <Trigger Property="IsSelected" Value="True">
                                                                    <Setter Property="BorderBrush" Value="{DynamicResource PrimaryBrush}"/>
                                                                    <Setter Property="Background" Value="{DynamicResource PrimaryBackgroundColor}"/>
                                                                </Trigger>
                                                                <Trigger Property="IsMouseOver" Value="True">
                                                                    <Setter Property="BorderBrush" Value="{DynamicResource BorderMediumBrush}"/>
                                                                </Trigger>
                                                            </ControlTemplate.Triggers>
                                                        </ControlTemplate>
                                                    </Setter.Value>
                                                </Setter>
                                            </Style>
                                        </ListBox.ItemContainerStyle>
                                        <!-- Le Template des items sera gÃ©nÃ©rÃ© en code pour plus de flexibilitÃ© -->
                                    </ListBox>

                                    <!-- Toolbar Bas -->
                                    <Border Grid.Row="2" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0" Padding="10">
                                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                            <Button x:Name="FormAddLabelBtn" Content="##loc:sp_builder.btn_add_label##" Style="{DynamicResource SecondaryButtonStyle}" Height="30" FontSize="11" Margin="0,0,5,0" ToolTip="##loc:form_editor.add_label_tooltip##"/>
                                            <Button x:Name="FormAddTextBtn" Content="##loc:sp_builder.btn_add_text##" Style="{DynamicResource SecondaryButtonStyle}" Height="30" FontSize="11" Margin="0,0,5,0" ToolTip="##loc:form_editor.add_text_tooltip##"/>
                                            <Button x:Name="FormAddComboBtn" Content="##loc:sp_builder.btn_add_combo##" Style="{DynamicResource SecondaryButtonStyle}" Height="30" FontSize="11" Margin="0,0,15,0" ToolTip="##loc:form_editor.add_combo_tooltip##"/>

                                            <!-- Correction IcÃ´nes -->
                                            <Button x:Name="FormMoveUpBtn" Content="â¬†ï¸" Style="{DynamicResource SecondaryButtonStyle}" Width="34" Height="30" Padding="0" Margin="0,0,5,0" ToolTip="##loc:form_editor.move_up_tooltip##"/>
                                            <Button x:Name="FormMoveDownBtn" Content="â¬‡ï¸" Style="{DynamicResource SecondaryButtonStyle}" Width="34" Height="30" Padding="0" Margin="0,0,15,0" ToolTip="##loc:form_editor.move_down_tooltip##"/>

                                            <Button x:Name="FormRemoveBtn" Content="ðŸ—‘ï¸" Style="{DynamicResource IconButtonStyle}" Width="34" Height="30" Padding="0" Foreground="{DynamicResource DangerBrush}" ToolTip="##loc:form_editor.remove_item_tooltip##"/>
                                        </StackPanel>
                                    </Border>
                                </Grid>
                            </Border>

                            <!-- DROITE : PROPRIÃ‰TÃ‰S -->
                            <Border Grid.Column="2" Style="{DynamicResource CardBorderStyle}" Padding="0">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <Border Grid.Row="0" Background="{DynamicResource BackgroundLightBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,0,0,1" Padding="15,10" CornerRadius="10,10,0,0">
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="âš™ï¸" Margin="0,0,10,0"/>
                                            <TextBlock Text="##loc:sp_builder.label_field_config##" FontWeight="SemiBold"/>
                                        </StackPanel>
                                    </Border>

                                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto" Padding="20">
                                        <StackPanel x:Name="FormPropertiesPanel">

                                            <!-- 1. Nom Interne (ENCAPSULÃ‰) -->
                                            <StackPanel x:Name="PanelPropName">
                                                <TextBlock Text="##loc:sp_builder.label_variable_name##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="PropNameBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,15"/>
                                                <TextBlock Text="##loc:sp_builder.help_variable_name##" FontSize="10" Foreground="{DynamicResource TextSecondaryBrush}" Margin="0,-10,0,20"/>
                                            </StackPanel>

                                            <!-- 2. Contenu (Label) -->
                                            <StackPanel x:Name="PanelPropContent">
                                                <TextBlock Text="##loc:sp_builder.label_displayed_text##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="PropContentBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,20"/>
                                            </StackPanel>

                                            <!-- 3. Valeur par dÃ©faut -->
                                            <StackPanel x:Name="PanelPropDefault">
                                                <TextBlock Text="##loc:sp_builder.label_default_value##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="PropDefaultBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,20"/>
                                            </StackPanel>

                                            <!-- 4. Options -->
                                            <StackPanel x:Name="PanelPropOptions">
                                                <TextBlock Text="##loc:sp_builder.label_options_list##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="PropOptionsBox" Style="{DynamicResource StandardTextBoxStyle}" Margin="0,5,0,20"/>
                                            </StackPanel>

                                            <!-- 5. Largeur (ENCAPSULÃ‰) -->
                                            <StackPanel x:Name="PanelPropWidth">
                                                <TextBlock Text="##loc:sp_builder.label_visual_width##" Style="{DynamicResource H4Style}"/>
                                                <TextBox x:Name="PropWidthBox" Style="{DynamicResource StandardTextBoxStyle}" Width="80" HorizontalAlignment="Left" Margin="0,5,0,20"/>
                                            </StackPanel>

                                            <!-- 6. Majuscules -->
                                            <StackPanel x:Name="PanelPropForceUpper" Orientation="Horizontal" Margin="0,0,0,20">
                                                <CheckBox x:Name="PropForceUpperCheck" Style="{DynamicResource ToggleSwitchStyle}"/>
                                                <TextBlock Text="##loc:sp_builder.label_force_upper##" VerticalAlignment="Center" Margin="10,0,0,0"/>
                                            </StackPanel>

                                        </StackPanel>
                                    </ScrollViewer>

                                    <!-- Overlay Vide -->
                                    <Grid x:Name="FormNoSelectionPanel" Grid.Row="1" Background="{DynamicResource WhiteBrush}" Visibility="Visible">
                                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Opacity="0.5">
                                            <TextBlock Text="ðŸ‘ˆ" FontSize="32" HorizontalAlignment="Center" Margin="0,0,0,10"/>
                                            <TextBlock Text="##loc:sp_builder.msg_select_field##" FontSize="14"/>
                                        </StackPanel>
                                    </Grid>
                                </Grid>
                            </Border>
                        </Grid>

                        <!-- 3. PREVIEW LIVE -->
                        <Border Grid.Row="2" Background="{DynamicResource WhiteBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0" Padding="25,15">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- Ligne 0 : Visuel -->
                                <TextBlock Grid.Row="0" Text="##loc:sp_builder.label_live_preview##" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,20,0"/>
                                <StackPanel Grid.Row="0" Grid.Column="1" x:Name="FormLivePreviewPanel" Orientation="Horizontal"/>

                                <!-- Ligne 1 : RÃ©sultat Textuel -->
                                <TextBlock Grid.Row="1" Text="##loc:sp_builder.label_generated_result##" FontSize="12" Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,15,20,0"/>
                                <Border Grid.Row="1" Grid.Column="1" Background="{DynamicResource BackgroundMediumBrush}" CornerRadius="6" Padding="12,8" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="1" Margin="0,15,0,0">
                                    <TextBlock x:Name="FormResultPreviewText" Text="..." FontFamily="Consolas" FontWeight="Bold" Foreground="{DynamicResource TextPrimaryBrush}" FontSize="13" TextWrapping="Wrap"/>
                                </Border>
                            </Grid>

                        </Border>
                        <!-- Footer Formulaire -->
                        <Border Grid.Row="3" Background="{DynamicResource WhiteBrush}" BorderBrush="{DynamicResource BorderLightBrush}" BorderThickness="0,1,0,0" Padding="25,15">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- Status Text -->
                                <TextBlock Grid.Column="0" x:Name="FormStatusText" Text="##loc:sp_builder.msg_ready##" FontSize="13" Foreground="{DynamicResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="0,0,20,0"/>

                                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right">
                                    <Button x:Name="FormNewButton" Content="##loc:sp_builder.btn_new##" Style="{DynamicResource SecondaryButtonStyle}" Height="36" Margin="0,0,10,0"/>
                                    <Button x:Name="FormSaveButton" Content="##loc:sp_builder.btn_save##" Style="{DynamicResource PrimaryButtonStyle}" Height="36"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </Grid>
                </TabItem>
            </TabControl>
        </Grid>
    </Grid>
</Window>